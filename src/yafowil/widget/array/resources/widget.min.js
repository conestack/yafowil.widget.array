var yafowil_array=function(e,t){"use strict";let a={before_add:{},add:{},remove:{},before_up:{},up:{},before_down:{},down:{},index:{}};class r{static initialize(e){t("div.array",e).each((function(){let e=t(this);-1===e.attr("id").indexOf("-TEMPLATE")&&new r(e)}))}constructor(e){e.data("yafowil-array",this),this.wrapper=e;let a=t("> table",e),r=t("> thead .array_actions",a),i=this.add_first_handle.bind(this);this.table=a,t("a.array_row_add",r).off().on("click",i),this.bind_actions()}bind_actions(){let e=t("> tbody > tr > td.actions .array_actions",this.table),a=this.add_handle.bind(this),r=this.remove_handle.bind(this),i=this.up_handle.bind(this),s=this.down_handle.bind(this);this.mark_disabled(e),t("a.array_row_add",e).off().on("click",a),t("a.array_row_remove",e).off().on("click",r),t("a.array_row_up",e).off().on("click",i),t("a.array_row_down",e).off().on("click",s)}mark_disabled(e){t("a.array_row_up",e).removeClass("array_row_up_disabled").first().addClass("array_row_up_disabled"),t("a.array_row_down",e).removeClass("array_row_down_disabled").last().addClass("array_row_down_disabled")}create_row(){let e=this.wrapper.attr("class"),a="";a+="<tr>",a+='<td class="widget">',a+="</td>",-1===e.indexOf("array-static")&&(a+='<td class="actions">',a+='<div class="array_actions">',e.indexOf("array-add")>-1&&(a+='<a class="array_row_add" href="#">',a+='<span class="icon-plus-sign"> </span>',a+="</a>"),e.indexOf("array-remove")>-1&&(a+='<a class="array_row_remove" href="#">',a+='<span class="icon-minus-sign"> </span>',a+="</a>"),e.indexOf("array-sort")>-1&&(a+='<a class="array_row_up" href="#">',a+='<span class="icon-circle-arrow-up"> </span>',a+="</a>",a+='<a class="array_row_down" href="#">',a+='<span class="icon-circle-arrow-down"> </span>',a+="</a>"),a+="</div>",a+="</td>"),a+="</tr>",a=t(a);let r=t("> .arraytemplate",this.wrapper).clone();return t(".widget",a).append(r.children()),a}get_row(e){return t(e).parent().parent().parent()}get base_id(){let e=this.wrapper.attr("id");return e.substring(6,e.length)}reset_indices(e){let r,i=0,s=this.base_id,n=this;e.children().each((function(){r=t(this),n.set_row_index(r,s,i),n.notify_hooks(a.index,r,i),i++})),this.bind_actions()}set_row_index(e,a,r){let i,s=a.replace(/\-/g,"."),n=this.set_attr_index,o=this;e.children().each((function(){i=t(this),n(i,"id",a,r,"-"),n(i,"for",a,r,"-"),n(i,"name",s,r,"."),o.set_row_index(i,a,r)}))}set_attr_index(e,t,a,r,i){let s=e.attr(t);if(s&&s.indexOf(a)>-1){let n=s.indexOf(a)+a.length+1,o=s.indexOf(i,n),d=s.substring(0,n),_="";o>-1&&(_=s.substring(o,s.length)),e.attr(t,d+r+_)}}notify_hooks(e,...t){for(let a in e)e[a].apply(null,t)}init_row(e,t){this.reset_indices(e),r.initialize(t),this.notify_hooks(a.add,t)}add_first_handle(e){e.preventDefault();let r=this.create_row(),i=t("> tbody",this.table);this.notify_hooks(a.before_add,r,i),i.prepend(r),this.init_row(i,r)}add_handle(e){e.preventDefault();let t=this.get_row(e.currentTarget),r=this.create_row(),i=t.parent();this.notify_hooks(a.before_add,r,i),t.after(r),this.init_row(i,r)}remove_handle(e){e.preventDefault();let t=this.get_row(e.currentTarget);this.notify_hooks(a.remove,t);let r=t.parent();t.remove(),this.reset_indices(r)}up_handle(e){e.preventDefault();let t=this.get_row(e.currentTarget);this.notify_hooks(a.before_up,t),t.insertBefore(t.prev()),this.reset_indices(t.parent()),this.notify_hooks(a.up,t)}down_handle(e){e.preventDefault();let t=this.get_row(e.currentTarget);this.notify_hooks(a.before_down,t),t.insertAfter(t.next()),this.reset_indices(t.parent()),this.notify_hooks(a.down,t)}}return t((function(){void 0!==window.ts?ts.ajax.register(r.initialize,!0):void 0!==window.bdajax?bdajax.register(r.initialize,!0):r.initialize()})),e.ArrayWidget=r,e.hooks=a,Object.defineProperty(e,"__esModule",{value:!0}),window.yafowil=window.yafowil||{},window.yafowil.array=e,e}({},jQuery);
