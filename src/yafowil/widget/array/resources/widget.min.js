!function(e,a){"use strict";let t={before_add:{},add:{},remove:{},before_up:{},up:{},before_down:{},down:{},index:{}};class r{static initialize(e){a("div.array",e).each((function(){new r(a(this))}))}constructor(e){this.wrapper=e,e.data("array",this);let t=a("> table",e),r=a("> thead .array_actions",t),i=this.add_first_handle.bind(this);this.table=t,a("a.array_row_add",r).off().on("click",i),this.bind_actions()}bind_actions(){let e=a("> tbody > tr > td.actions .array_actions",this.table),t=this.add_handle.bind(this),r=this.remove_handle.bind(this),i=this.up_handle.bind(this),s=this.down_handle.bind(this);this.mark_disabled(e),a("a.array_row_add",e).off().on("click",t),a("a.array_row_remove",e).off().on("click",r),a("a.array_row_up",e).off().on("click",i),a("a.array_row_down",e).off().on("click",s)}mark_disabled(e){a("a.array_row_up",e).removeClass("array_row_up_disabled").first().addClass("array_row_up_disabled"),a("a.array_row_down",e).removeClass("array_row_down_disabled").last().addClass("array_row_down_disabled")}create_row(){let e=this.wrapper.attr("class"),t="";t+="<tr>",t+='<td class="widget">',t+="</td>",-1===e.indexOf("array-static")&&(t+='<td class="actions">',t+='<div class="array_actions">',e.indexOf("array-add")>-1&&(t+='<a class="array_row_add" href="#">',t+='<span class="icon-plus-sign"> </span>',t+="</a>"),e.indexOf("array-remove")>-1&&(t+='<a class="array_row_remove" href="#">',t+='<span class="icon-minus-sign"> </span>',t+="</a>"),e.indexOf("array-sort")>-1&&(t+='<a class="array_row_up" href="#">',t+='<span class="icon-circle-arrow-up"> </span>',t+="</a>",t+='<a class="array_row_down" href="#">',t+='<span class="icon-circle-arrow-down"> </span>',t+="</a>"),t+="</div>",t+="</td>"),t+="</tr>",t=a(t);let r=a("> .arraytemplate",this.wrapper).clone();return a(".widget",t).append(r.children()),t}get_row(e){return a(e).parent().parent().parent()}get base_id(){let e=this.wrapper.attr("id");return e.substring(6,e.length)}reset_indices(e){let r,i=0,s=this.base_id,n=this;e.children().each((function(){r=a(this),n.set_row_index(r,s,i),n.notify_hooks(t.index,r,i),i++})),this.bind_actions()}set_row_index(e,t,r){let i,s=t.replace(/\-/g,"."),n=this.set_attr_index;e.children().each((function(){i=a(this),n(i,"id",t,r,"-"),n(i,"for",t,r,"-"),n(i,"name",s,r,"."),i.attr("class").indexOf("array")>-1&&i.data("array").set_row_index(i,t,r)}))}set_attr_index(e,a,t,r,i){let s=e.attr(a);if(s&&s.indexOf(t)>-1){let n=s.indexOf(t)+t.length+1,o=s.indexOf(i,n),d=s.substring(0,n),_="";o>-1&&(_=s.substring(o,s.length)),e.attr(a,d+r+_)}}notify_hooks(e,...a){for(let t in e)e[t].apply(null,a)}add_first_handle(e){e.preventDefault();let i=this.create_row(),s=a("> tbody",this.table);this.notify_hooks(t.before_add,i,s),s.prepend(i),r.initialize(i),this.reset_indices(s),this.notify_hooks(t.add,i)}add_handle(e){e.preventDefault();let a=this.get_row(e.currentTarget),r=this.create_row(),i=a.parent();this.notify_hooks(t.before_add,r,i),a.after(r),this.reset_indices(i),this.notify_hooks(t.add,r)}remove_handle(e){e.preventDefault();let a=this.get_row(e.currentTarget);this.notify_hooks(t.remove,a);let r=a.parent();a.remove(),this.reset_indices(r)}up_handle(e){e.preventDefault();let a=this.get_row(e.currentTarget);this.notify_hooks(t.before_up,a),a.insertBefore(a.prev()),this.reset_indices(a.parent()),this.notify_hooks(t.up,a)}down_handle(e){e.preventDefault();let a=this.get_row(e.currentTarget);this.notify_hooks(t.before_down,a),a.insertAfter(a.next()),this.reset_indices(a.parent()),this.notify_hooks(t.down,a)}}a((function(){void 0!==window.ts?ts.ajax.register(r.initialize,!0):r.initialize()})),e.ArrayWidget=r,e.hooks=t,Object.defineProperty(e,"__esModule",{value:!0}),void 0===window.yafowil&&(window.yafowil={}),window.yafowil.array=e}({},jQuery);
//# sourceMappingURL=widget.min.js.map
